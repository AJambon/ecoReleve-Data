BEGIN TRAN T1
/* Habitat ==> relier au thésaurus "Type de milieux", ID 225869 */

UPDATE [dbo].[ModuleForms]
   SET [FormOrder] = 1
      ,[Options] = 225869
	  ,[InputType] = 'AutocompTreeEditor'
 WHERE [Name] = 'habitat'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_population' )

 /*Micro habitat ==> relier au thésaurus "Type de micro-habitats", ID 226029*/

 UPDATE [dbo].[ModuleForms]
   SET [FormOrder] = 2
      ,[Options] = 226029
	  ,[InputType] = 'AutocompTreeEditor'
 WHERE [Name] = 'micro_habitat'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_population' )

 /* Host plant ==> Champ à rajouter, à relier au thésaurus "Plantes" ID 204083*/
INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
           ,[Options]
           ,[Status])
     VALUES
           (1
           ,223
           ,'Host Plant'
           ,'Host Plant'
           ,0
           ,150
           ,150
           ,'AutocompTreeEditor'
           ,'form-control'
           ,2
           ,3
           ,204083
           ,1)
 /*Capture ==> A renommer en Method (toujours le même champ thésaural)*/
  UPDATE [dbo].[ModuleForms]
   SET [FormOrder] = 4
	  ,[Name] = 'Method'
	  ,[Label] = 'Method'
 WHERE [Name] = 'Name_Capture'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_population' )
 /* Trap state ==> Champ à rajouter, à relier au thésaurus "Etat du piège", ID 2011307*/
 INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
           ,[Options]
           ,[Status])
     VALUES
           (1
           ,223
           ,'Trap_state'
           ,'Trap state'
           ,0
           ,150
           ,150
           ,'AutocompTreeEditor'
           ,'form-control'
           ,2
           ,5
           ,2011307
           ,1)

/* Comments*/

 UPDATE [dbo].[ModuleForms]
   SET [FormOrder] = 6
 WHERE [Name] = 'Comments'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_population' )

 /* Supprimer Code_Piege*/

DELETE FROM [dbo].[ModuleForms]
      WHERE [Name] ='Code_Piege'
	  AND   TypeObj = ( select id from ProtocoleType where name = 'Entomo_population' )

/*Renommer le nom du protocole "Arthropod survey" */

UPDATE [dbo].[ProtocoleType]
   SET [Name] = 'Athropod_survey'
 WHERE [Name] = 'Entomo_population'

 COMMIT TRAN T1;



BEGIN TRAN T2;

/* Taxon   */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 1
		,[Required] = 1
		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		 
		WHERE [Name] = 'taxon'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Collector : renommer en Observation by */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 2
		,[Required] = 1
		,[Name] = 'Observation_by'
		,[Label] = 'Observation by'		 
		WHERE [Name] = 'Collecteur'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Identified by : renommer en Identification by */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 3
		,[Required] = 1
		,[Name] = 'Identification_by'
		,[Label] = 'Identification by'		 
		WHERE [Name] = 'Identified_by'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Identified on : renommer en Identification year */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 4
		,[Required] = 1
		,[Name] = 'Identification year'
		,[Label] = 'Identification_year'		 
		WHERE [Name] = 'Identified_on'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Sure */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 5
		WHERE [Name] = 'identity_sure'
		and [label] = 'Sure'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Collected : renommer en Sampled */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 6
		,[Name] = 'Sampled'
		,[Label] = 'Sampled'
		WHERE [Name] = 'sampled'
		and [label] = 'Collected'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )


/* Picture : champ à rajouter, de type case à cocher */
 INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
           ,[Status]
		   ,[Locked]
		   ,[Rules])
     VALUES
           (1
           ,231
           ,'Picture'
           ,'Picture'
           ,0
           ,150
           ,150
           ,'Checkbox'
           ,'form-control'
           ,2
           ,7
           ,1
		   ,1
		   ,'{"operator":"disable","target":"Picture","source":"Picture","value":1}'
		   )

/* Stade : renommer en Stage */
 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 8
		,[Name] = 'Stage'
		,[Label] = 'Stage'
		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		WHERE [Name] = 'stade'
		and [label] = 'Stade'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Sex */
 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 9
   		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		WHERE [Name] = 'sex'
		and [label] = 'Sex'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Number */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 10
   		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		WHERE [Name] = 'number'
		and [label] = 'number'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/*Weight : champ à rajouter de type décimal (4 chiffres après la virgule) */
 INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
           ,[Status]
		   ,[Locked]
		   ,[Rules])
     VALUES
           (1
           ,231
           ,'Weight'
           ,'Weight'
           ,0
           ,150
           ,150
           ,'Number'
           ,'form-control'
           ,2
           ,11
           ,1
		   ,1
		   ,'{"operator":"disable","target":"Number","source":"Number","value":1}'
		   )

/* Behaviour */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 12
   		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		WHERE [Name] = 'behaviour'
		and [label] = 'behaviour'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Comments */

 UPDATE [dbo].[ModuleForms]
   SET   [FormOrder] = 13
   		,[FieldSizeEdit] = 150
		,[FieldSizeDisplay] = 150
		WHERE [Name] = 'Comments'
		and [label] = 'Comments'
 and   TypeObj = ( select id from ProtocoleType where name = 'Entomo_Pop_Census' )

/* Subdivided subdivisé) : champ à rajouter, relié au champ thésaural ID 2011341, Subdivision d’échantillon. Valeur bloquée à « non » à la saisie.*/
 INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
		   ,[options]
           ,[Status]
		   ,[Locked]
		   ,[Rules])
     VALUES
           (1
           ,231
           ,'Subdivided'
           ,'Subdivided'
           ,0
           ,150
           ,150
           ,'AutocompTreeEditor'
           ,'form-control'
           ,2
           ,14
		   ,2011341
           ,1
		   ,1
		   ,'{"operator":"disable","target":"Subdivided","source":"Subdivided","value":1}'
		   )


/* FK_SubArtrhopodSurvey : champ à rajouter, bloqué à NULL à la saisie. */
 INSERT INTO [dbo].[ModuleForms]
           ([module_id]
           ,[TypeObj]
           ,[Name]
           ,[Label]
           ,[Required]
           ,[FieldSizeEdit]
           ,[FieldSizeDisplay]
           ,[InputType]
           ,[editorClass]
           ,[FormRender]
           ,[FormOrder]
		   ,[displayClass]
		   ,[editorClass]
           ,[Status]
		   ,[Locked]
		   ,[DefaultValue]
		   ,[Rules])
     VALUES
           (1
           ,231
           ,'FK_SubArtrhopodSurvey'
           ,'FK_SubArtrhopodSurvey'
           ,0
           ,150
           ,150
           ,'Number'
           ,'form-control'
           ,0
           ,0
		   ,'hide'
		   ,'hide'
		   ,null
           ,1
		   ,1
		   ,'{"operator":"disable","target":"FK_SubArtrhopodSurvey","source":"FK_SubArtrhopodSurvey","value":1}'
		   )


/*
     x Figer le champ Taxon à gauche
     x Réduire la taille des champs Sex, Stage, Number, Sampled, Picture, Sure : divisé par 2, et augmenter par 2 la taille du champ Taxon
     x Voire si on peut interdire la valeur 0 pour le champ Number (uniquement à la saisie, potentiellement cela peut revenir à 0 en venant du bridge)
*/
/* Renommer le nom du protocole en "Sub arthropod survey" */
UPDATE [dbo].[ProtocoleType]
   SET [Name] = 'Sub_Athropod_survey'
 WHERE [Name] = 'Entomo_Pop_Census'

COMMIT TRAN T2;






INSERT INTO [dbo].[TVersion] (TVer_FileName,TVer_Date,TVer_DbName) VALUES ('120_upgrade_conf_proto_entomo_poppulation_and_sub_proto_entomo_pop_census',GETDATE(),(SELECT db_name()))


GO
